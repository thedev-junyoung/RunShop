# 작업 일지 - 2024년 9월 17일

## 주요 작업 사항

### 1. **User 엔티티에서 VO 추출 작업**

- `Email`, `Password`, `Address`와 같은 값 객체(Value Object, VO)를 추출하여 `User` 엔티티에서 관리되도록 구조 변경.
    - `Email` VO는 이메일 형식 유효성을 검증하는 로직을 포함하며, 유효하지 않은 이메일 형식의 입력을 차단.
    - `Password` VO는 비밀번호 암호화 기능을 제공하며, bcrypt를 이용해 비밀번호를 안전하게 저장하도록 구현.
    - `Address` VO는 도로명 주소, 상세주소, 도시, 지역, 우편번호로 구성된 주소 정보를 구조화하여 관리.
- 이러한 VO 도입으로 `User` 엔티티의 책임이 분리되고, 각 VO는 해당 데이터에 대한 검증 및 처리를 자체적으로 수행.
- VO로 변경된 필드를 반영하여, `UserController`, `UserService` 등 관련된 모든 로직을 수정. VO 클래스 내에 포함된 검증 로직에 따라 클라이언트에서 들어오는 잘못된 데이터 입력을 사전에 차단.
- `@Embeddable` 어노테이션을 사용해 VO 클래스들이 JPA 엔티티에 통합될 수 있도록 설정.
- 이 과정에서 `User` 관련 기능의 단위 테스트와 통합 테스트를 수정하여, VO 적용에 따른 데이터 흐름과 검증 로직이 올바르게 작동하는지 확인.

### 2. **주문 및 결제 기능 추가**

- 주문 및 결제 처리 로직을 서비스 계층에 추가. `Order`와 `Payment` 엔티티 간의 연관관계를 설정하여 결제 완료 시 주문 상태가 적절히 변경되도록 구현.
    - `Order` 엔티티는 여러 개의 `OrderItem`을 가지며, `Payment`와 일대일 관계를 맺고 결제와 관련된 정보를 관리.
    - 주문이 생성된 후, 결제가 완료되면 `OrderStatus`가 `PAID`로 변경되고, 결제 실패 시 상태는 `FAILED`로 유지.
- `PaymentService`에서는 실제 결제 요청 및 응답 처리 로직을 구현하고, 트랜잭션 처리를 통해 결제 실패 시에도 데이터의 일관성을 보장.
    - 결제 로직은 외부 결제 API와 연동되는 부분이므로, 해당 API 호출 부분은 Mock 처리하여 결제 성공/실패 시나리오에 대한 테스트를 진행.
- 결제에 대한 단위 테스트 및 통합 테스트 작성. 단위 테스트에서는 각각의 서비스 로직이 제대로 작동하는지 확인하고, 통합 테스트에서는 결제 프로세스 전체가 정상 동작하는지 검증.
    - 정상 결제 및 결제 실패 상황에 대한 예외 처리를 추가하여, 오류 발생 시 클라이언트에 적절한 응답을 반환하도록 설계.

## 개선 사항

- **User VO 관리**: `Email`, `Password`, `Address` 등의 VO를 도입함으로써 `User` 엔티티의 책임이 분리되고, VO 내부에서 자체적인 검증과 처리가 가능하게 되어 데이터 무결성이 크게 향상됨. 또한 도메인 주도 설계(Domain-Driven Design)를 고려하여, VO 패턴을 통해 각 필드의 의미를 더욱 명확히 드러냄.
- **DTO 구조 정리**: 주문 및 결제 관련 요청과 응답을 DTO로 정리하여 데이터 전송 로직이 단순화되었으며, 추후 API 확장에도 유연하게 대응할 수 있도록 설계. 서비스 계층에서 DTO를 활용함으로써, 클라이언트와의 데이터 교환이 명확하게 구조화됨.
